import twitterAPI from './twitter-api.js';
import {
  saveEmailToJson,
  showSubscriptionConfirmation,
} from './email-json-handler.js';
function toggleFAQ(e) {
  const t = document.querySelectorAll('.faq-item'),
    n = t[e],
    o = n.querySelector('.faq-answer'),
    r = n.querySelector('.faq-arrow');
  t.forEach((t, n) => {
    n !== e &&
      (t.querySelector('.faq-answer').classList.remove('active'),
      t.querySelector('.faq-arrow').classList.remove('active'));
  }),
    o.classList.toggle('active'),
    r.classList.toggle('active');
}
function scrollToFinalCTA() {
  document.getElementById('finalCTA').scrollIntoView({ behavior: 'smooth' });
}
(window.scrollToFinalCTA = scrollToFinalCTA),
  document.getElementById('heroForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const t = this.querySelector('.email-input').value;
    handleFormSubmission(t, 'hero');
  }),
  document.getElementById('finalForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const t = this.querySelector('.final-email-input').value;
    handleFormSubmission(t, 'final');
  });
async function handleFormSubmission(e, t) {
  try {
    const n = await saveEmailToJson(e, t);
    n
      ? showSubscriptionConfirmation(e)
      : alert(
          'Ha ocurrido un error al guardar tu email. Por favor, inténtalo de nuevo.'
        ),
      console.log('Form submitted:', {
        email: e,
        source: t,
        timestamp: new Date(),
      });
  } catch (e) {
    console.error('Error al procesar el formulario:', e),
      alert(
        'Ha ocurrido un error al procesar tu solicitud. Por favor, inténtalo de nuevo.'
      );
  }
}
async function shareOnTwitter(e) {
  const t = e.currentTarget,
    n = t.textContent;
  (t.textContent = 'Compartiendo...'), (t.disabled = !0);
  try {
    const e = t.closest('.resource-card'),
      o = e ? e.querySelector('h3').textContent : '',
      r = e ? e.querySelector('p').textContent.trim() : '',
      a = `user_${Math.floor(1e4 * Math.random())}`;
    let i = '';
    const s =
      document.querySelector('.email-input') ||
      document.querySelector('.final-email-input');
    s && s.value && (i = s.value),
      (t.textContent = 'Comparte en la ventana emergente...');
    try {
      const e = await twitterAPI.sharePost(
        `¡Acabo de desbloquear "${o}" en MetaSoccer Community! La plataforma definitiva para dominar el juego del futuro. #MetaSoccer #GameFi #P2E`,
        a,
        i,
        o
      );
      if (e.success) {
        (t.textContent = '¡Compartido con éxito!'),
          localStorage.setItem('sharedResourceTitle', o),
          localStorage.setItem('sharedResourceDescription', r),
          await new Promise(e => setTimeout(e, 1e3));
        const n = `${e.redirectUrl}?title=${encodeURIComponent(
          o
        )}&desc=${encodeURIComponent(r)}`;
        window.location.href = n;
      } else
        alert(`Error: ${e.message}`), (t.textContent = n), (t.disabled = !1);
    } catch (e) {
      console.error('Error en el proceso de compartir:', e),
        alert(`No se completó el proceso de compartir: ${e.message}`),
        (t.textContent = n),
        (t.disabled = !1);
    }
  } catch (e) {
    console.error('Error al preparar el proceso de compartir:', e),
      alert(
        'Ha ocurrido un error al intentar compartir en Twitter. Por favor, inténtalo de nuevo.'
      ),
      (t.textContent = n),
      (t.disabled = !1);
  }
}
document.querySelectorAll('.resource-button').forEach(e => {
  e.addEventListener('click', shareOnTwitter);
}),
  window.addEventListener('load', function () {
    document.querySelectorAll('.fade-in-up').forEach((e, t) => {
      setTimeout(() => {
        (e.style.opacity = '1'), (e.style.transform = 'translateY(0)');
      }, 200 * t);
    });
  }),
  document.querySelectorAll('.fade-in-up').forEach(e => {
    (e.style.opacity = '0'),
      (e.style.transform = 'translateY(30px)'),
      (e.style.transition = 'all 0.6s ease');
  });
window.toggleFAQ = toggleFAQ;
